/**
 * @file Firestore Security Rules
 * @core-philosophy This ruleset protects contact form submissions. It allows public reads
 *   but restricts writes to authenticated users to prevent unauthorized data modification.
 * @data-structure Contact form submissions are stored in the `contactFormSubmissions`
 *   collection, with each document representing a single submission.
 * @key-security-decisions Listing contact form submissions is denied to all users, 
 *   including authenticated ones, for data privacy.
 *   Writes are only allowed for authenticated users.
 */
rules_version = '2';
service cloud.firestore {
  match /databases/{database}/documents {

    /**
     * @description Controls access to the `contactFormSubmissions` collection.
     *   Allows anyone to read submissions, but restricts creation, updates, and deletes
     *   to only authenticated users.
     * @path /contactFormSubmissions/{contactFormSubmissionId}
     * @allow (get) Any user can read a contact form submission.
     * @allow (create) Only authenticated users can submit the form.
     * @deny (list) Listing of contact form submissions is not allowed.
     * @deny (update) Updates are not allowed.
     * @deny (delete) Deletes are not allowed.
     * @principle Restricts write access to authorized users.
     */
    match /contactFormSubmissions/{contactFormSubmissionId} {
      allow get: if true;
      allow list: if false;
      allow create: if isSignedIn();
      allow update: if false;
      allow delete: if false;
    }

    // --- Helper Functions ---
    function isSignedIn() {
      return request.auth != null;
    }
  }
}